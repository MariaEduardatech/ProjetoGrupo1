<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style/dashboard.css">
    <link rel="icon" href="./style/assets/PitaTech_logo.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/sessao.js"></script>

    <title>Dashboard | Pitatech</title>

</head>

<body onload="validarSessao()">

    <header>

        <div class="navbar">

            <img src="./style/assets/PitaTech_logo.png" alt="Logo Pitatech">

            <ul>
                <li><a href="index.html">Home</a></li>
                <li id="selecionado"><a href="#">Dashboard</a></li>
                <li><a href="calculadora.html">Calculadora</a></li>
                <li><a href="quemsomos.html">Quem somos</a></li>

            </ul>

            <div id="b_usuario"><a href="./login.html">Entrar</a></div>
            <div class="sair" onclick="limparSessao()">
                <h3><a href="./login.html">Sair</a></h3>
            </div>

        </div>

    </header>

    

    <div class="container-dashboard">
    <section class="dashboard">
        <h1>Talhao 3</h1>
          
        <div class="KPITalh√£o">
  <div class="kpi-card">
    <div class="kpi-titulo">√öltima Chuva Registrada</div>
    <div class="kpi-valor" id="ultimaChuva"></div>
  </div>

  <div class="kpi-card">

    <div class="kpi-titulo">Tempo desde o √öltimo Alerta</div>
    <div class="kpi-valor" id="tempoAlerta"></div>
  </div>
    <div class="kpi-card" id="kpiSituacao" style="border-left: 13px solid #b51616;">
      <div class="kpi-title">Situa√ß√£o Atual do Solo</div>
      <div class="kpi-value" id="valorSituacao">UMIDADE NORMAL</div>
    </div>
<div class="legenda">
    <h3>Legenda de Umidade</h3>
    <div class="faixa"><div class="cor vermelho-bg"></div> Umidade < 60% ou > 80% - Cr√≠tica</div>
    <div class="faixa"><div class="cor amarelo-bg"></div> Umidade entre 56‚Äì59% ou 76‚Äì80% - Aten√ß√£o</div>
    <div class="faixa"><div class="cor verde-bg"></div> Umidade entre 60% e 76% - Normal</div>
  </div>

  </div>

  

             <div class="graficoa">
        <div class="grafico">
              <h2>Umidade do Solo (Tempo Real)</h2>
  <canvas id="graficoLinhas"></canvas>
        </div>

        <div class="graficou">
           <h2>Gr√°fico de Dispers√£o ‚Äì Umidade vs Tempo Ap√≥s Chuva</h2>
  <canvas id="graficoDispersao"></canvas>
        </div>
    
    </div>
    </div>
        </section>
    </div>

    <div id="voltar-container">
        <a href="dashboard.html" class="voltar-btn">
            <img src="https://cdn-icons-png.freepik.com/256/9517/9517597.png" alt="Voltar">
            Voltar
        </a>
    </div>


   
    <footer>
        <div class="navfot">
            <div id="menu-redes">
                <div id="lista">
                    <ul>
                        <li><a href="./home.html">Home</a></li>
                        <li><a href="./dashboard.html">Dashboard</a></li>
                        <li><a href="#">Calculadora</a></li>
                        <li><a href="./quemsomos.html">Quem somos</a></li>     
                    </ul>
                </div>

                <div id="logo">
                    <img src="./style/assets/PitaTech_logo.png" alt="PitaTech_logo">
                </div>
             
                <div id="redes2">
                    <img src="./style/assets/instagram.png" alt="Logo do Instagram"><span id="instagram">Instagram</span>
                    <img src="./style/assets/linkedin.png" alt="Logo do Linkedin"><span id="linkedin">Linkedin</span>
                    <img src="./style/assets/facebook.png" alt="Logo do Facebook"><span id="facebook">Facebook</span>
                </div>
            </div>
    
            <span id="direitos">PITATECH ¬© 2025. Todos os direitos reservados. Desenvolvido por PITATECH TEAM.</span>
        </div>
    </footer>
</body>
</html>

            
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
 const ultimaChuva = new Date(Date.now() - 4 * 60 * 60 * 1000);
    document.getElementById("ultimaChuva").innerText = ultimaChuva.toLocaleString("pt-BR");

    // Simula√ß√£o: √∫ltimo alerta foi h√° 1 hora e 45 minutos
    const tempoAlertaMinutos = 105;
    const horas = Math.floor(tempoAlertaMinutos / 60);
    const minutos = tempoAlertaMinutos % 60;
    document.getElementById("tempoAlerta").innerText = `${horas}h ${minutos}min`;
    const labels = ["06:00", "09:00", "12:00", "15:00", "18:00", "21:00", "00:00", "03:00"]; // Simula√ß√£o de horas

    const dadosPorSensor = {
      T3: [45, 42, 39, 35, 33, 30, 35, 32]
    };

    const cores = ["#a1488b"];

    const datasets = Object.keys(dadosPorSensor).map((sensor, index) => ({
      label: `Sensor ${sensor}`,
      data: dadosPorSensor[sensor],
      borderColor: cores[index],
      tension: 0.3,
      fill: false,
      pointRadius: 4
    }));

    new Chart(document.getElementById("graficoLinhas"), {
      type: 'line',
      data: {
        labels: labels,
        datasets: datasets
      },
      options: {
        scales: {
          y: {
            title: {
              display: true,
              text: 'Umidade (%)'
            },
            min: 0,
            max: 100
          },
          x: {
            title: {
              display: true,
              text: 'Hor√°rio da leitura'
            }
          }
        },
        plugins: {
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y}%`
            }
          },
          legend: {
            position: 'top'
          }
        }
      }
    });



    const sensores = [
      { id: "S1", horasDesdeChuva: 1, umidade: 60 },
      { id: "S2", horasDesdeChuva: 2, umidade: 55 },
      { id: "S3", horasDesdeChuva: 4, umidade: 48 },
      { id: "S4", horasDesdeChuva: 6, umidade: 41 },
      { id: "S5", horasDesdeChuva: 8, umidade: 36 },
      { id: "S6", horasDesdeChuva: 10, umidade: 30 },
      { id: "S7", horasDesdeChuva: 12, umidade: 25 }
    ];

    const dadosDispersao = sensores.map(sensor => ({
      x: sensor.horasDesdeChuva,
      y: sensor.umidade,
      r: 6
    }));

    new Chart(document.getElementById("graficoDispersao"), {
      type: 'scatter',
      data: {
        datasets: [{
          label: 'Umidade por Sensor',
          data: dadosDispersao,
          backgroundColor: 'rgba(54, 162, 235, 0.7)'
        }]
      },
      options: {
        scales: {
          x: {
            title: {
              display: true,
              text: 'Horas desde a √∫ltima chuva'
            },
            beginAtZero: true
          },
          y: {
            title: {
              display: true,
              text: 'Umidade do solo (%)'
            },
            beginAtZero: true,
            max: 100
          }
        },
        plugins: {
          tooltip: {
            callbacks: {
              label: ctx => {
                const index = ctx.dataIndex;
                return `${sensores[index].id}: ${ctx.parsed.y}% umidade ap√≥s ${ctx.parsed.x}h`;
              }
            }
          }
        }
      }
    });
      const umidadeAtual = 58; // voc√™ pode trocar aqui para testar outras faixas

// Situa√ß√£o atual
    const valorSituacao = document.getElementById("valorSituacao");
    const iconeSituacao = document.getElementById("iconeSituacao");
    const kpiSituacao = document.getElementById("kpiSituacao");

    if (umidadeAtual > 80 || umidadeAtual < 60) {
      valorSituacao.innerText = "UMIDADE CR√çTICA";
      iconeSituacao.innerText = "üî¥";
      iconeSituacao.className = "kpi-icon vermelho";
    } else if ((umidadeAtual >= 76 && umidadeAtual <= 80) || (umidadeAtual >= 56 && umidadeAtual < 60)) {
      valorSituacao.innerText = "UMIDADE INST√ÅVEL";
      iconeSituacao.innerText = "üü°";
      iconeSituacao.className = "kpi-icon amarelo";
    } else {
      valorSituacao.innerText = "UMIDADE NORMAL";
      iconeSituacao.innerText = "üü¢";
      iconeSituacao.className = "kpi-icon verde";
    }

    </script>
    